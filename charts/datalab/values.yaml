# PostgreSQL configuration
postgresql:
  enabled: true
  auth:
    username: ducklake
    password: ducklake
    database: ducklake
    postgresPassword: postgres
  primary:
    persistence:
      enabled: true
      size: 10Gi

# Garage S3 storage configuration
garage:
  # Deployment configuration
  deployment:
    replicaCount: 1
  
  # Garage configuration
  garage:
    replicationFactor: "1"  # 1 pour un seul nœud
    s3:
      api:
        region: "garage"
        rootDomain: ".s3.tgu.ovh"
      web:
        rootDomain: ".web.tgu.ovh"
        index: "index.html"
  
  # Persistence
  persistence:
    enabled: true
    meta:
      size: 1Gi
      storageClass: null
    data:
      size: 10Gi
      storageClass: null
  
  # Ingress configuration
  ingress:
    s3:
      api:
        enabled: true
        annotations:
          cert-manager.io/cluster-issuer: "letsencrypt-prod"
          nginx.ingress.kubernetes.io/proxy-body-size: 1024m
        hosts:
          - host: s3.tgu.ovh
            paths:
              - path: /
                pathType: Prefix
          - host: "*.s3.tgu.ovh"
            paths:
              - path: /
                pathType: Prefix
        tls:
          - secretName: garage-s3-tls
            hosts:
              - s3.tgu.ovh
              - "*.s3.tgu.ovh"
      web:
        enabled: true
        annotations:
          cert-manager.io/cluster-issuer: "letsencrypt-prod"
        hosts:
          - host: "*.web.tgu.ovh"
            paths:
              - path: /
                pathType: Prefix
        tls:
          - secretName: garage-web-tls
            hosts:
              - "*.web.tgu.ovh"

# MLflow configuration
# mlflow:
#   # PostgreSQL backend configuration
#   backendStore:
#     postgres:
#       enabled: true
#       host: "datalab-postgresql"
#       port: 5432
#       database: "mlflow"
#       username: "mlflow"
#       password: "mlflow"

#   # S3 artifact store with Garage
#   artifactRoot:
#     s3:
#       enabled: true
#       bucket: "mlflow"
#       awsAccessKeyId: "GK..."
#       awsSecretAccessKey: "..."

#   # Environment variables for S3/Garage connection
#   extraEnvVars:
#     MLFLOW_S3_ENDPOINT_URL: "http://datalab-garage:3900"
#     MLFLOW_S3_IGNORE_TLS: "true"
#     AWS_DEFAULT_REGION: "garage"

#   # Service configuration
#   service:
#     type: ClusterIP
#     port: 5000

#   # Disable MLflow native ingress (ne gère pas TLS correctement)
#   ingress:
#     enabled: false
  
# mysql:
#   image:
#     repository: bitnamilegacy/mysql
#   auth:
#     database: zenml
#     username: zenml
#     password: zenml
#     rootPassword: password

# zenml:
#   zenml:
#     database:
#       url: "mysql://zenml:zenml@lab-mysql.ia-lab.svc.cluster.local:3306/zenml"
#     ingress:
#       enabled: true
#       annotations:
#         cert-manager.io/cluster-issuer: "letsencrypt-prod"
#       host: zenml.tgu.ovh
#       tls:
#         enabled: true
#         secretName: zenml-tls-certs

# # Custom Ingress for MLflow with TLS support
# ingress:
#   enabled: true
#   className: "nginx"
#   annotations:
#     cert-manager.io/cluster-issuer: "letsencrypt-prod"
#     nginx.ingress.kubernetes.io/proxy-body-size: 512m
#     nginx.ingress.kubernetes.io/proxy-connect-timeout: "180"
#     nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
#     nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
#   hosts:
#     - host: mlflow.tgu.ovh
#       paths:
#         - path: /
#           pathType: Prefix
#   tls:
#     - secretName: mlflow-tls
#       hosts:
#         - mlflow.tgu.ovh

# # Persistence configuration
# persistence:
#  size: 10Gi
#  accessMode: ReadWriteOnce
