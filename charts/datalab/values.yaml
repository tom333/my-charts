# PostgreSQL configuration
postgresql:
  image:
    repository: bitnamilegacy/postgresql
  auth:
    username: ducklake
    password: ducklake
    database: ducklake
    postgresPassword: postgres
  primary:
    persistence:
      enabled: true
      size: 10Gi

# RustFS S3 storage configuration (standalone mode)
rustfs:
  # Standalone deployment configuration
  mode: standalone
  
  replicaCount: 1
  
  # S3 configuration
  s3:
    region: "rustfs"
    endpoint: "s3.tgu.ovh"
  
  # Persistence
  persistence:
    enabled: true
    size: 10Gi
    storageClass: null
  
  # Ingress configuration
  ingress:
    enabled: true
    className: nginx
    nginxAnnotations:
      nginx.ingress.kubernetes.io/affinity: cookie
      nginx.ingress.kubernetes.io/proxy-body-size: "0"
      nginx.ingress.kubernetes.io/session-cookie-expires: "3600"
      nginx.ingress.kubernetes.io/session-cookie-hash: sha1
      nginx.ingress.kubernetes.io/session-cookie-max-age: "3600"
      nginx.ingress.kubernetes.io/session-cookie-name: rustfs
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: s3.tgu.ovh
        paths:
          - path: /
            pathType: Prefix
    tls:
      enabled: true
      secretName: rustfs-s3-tls

# MLflow configuration
mlflow:
  # PostgreSQL backend configuration
  mlflow:
    database:
      hostname: "datalab-postgresql"
      port: 5432
      name: "ducklake"
      username: "ducklake"
      password: "ducklake"
    
    # S3 artifact store with RustFS
    s3:
      path: "s3://mlflow"
  
  # Environment variables for S3/RustFS connection
  extraEnvs:
    - name: MLFLOW_S3_ENDPOINT_URL
      value: "http://datalab-rustfs:9000"
    - name: AWS_ACCESS_KEY_ID
      value: "rustfsadmin"
    - name: AWS_SECRET_ACCESS_KEY
      value: "rustfsadmin"
    - name: AWS_DEFAULT_REGION
      value: "rustfs"
  
  # Service configuration
  service:
    type: ClusterIP
    port: 80
    targetPort: 5000
  
  # Ingress configuration
  ingress:
    enabled: true
    path: /
    hosts:
      - mlflow.tgu.ovh
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/proxy-body-size: "512m"
      nginx.ingress.kubernetes.io/proxy-connect-timeout: "180"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    tls:
      - secretName: mlflow-tls
        hosts:
          - mlflow.tgu.ovh

# mysql:
#   image:
#     repository: bitnamilegacy/mysql
#   auth:
#     database: zenml
#     username: zenml
#     password: zenml
#     rootPassword: password

# zenml:
#   zenml:
#     database:
#       url: "mysql://zenml:zenml@lab-mysql.ia-lab.svc.cluster.local:3306/zenml"
#     ingress:
#       enabled: true
#       annotations:
#         cert-manager.io/cluster-issuer: "letsencrypt-prod"
#       host: zenml.tgu.ovh
#       tls:
#         enabled: true
#         secretName: zenml-tls-certs

# # Custom Ingress for MLflow with TLS support
# ingress:
#   enabled: true
#   className: "nginx"
#   annotations:
#     cert-manager.io/cluster-issuer: "letsencrypt-prod"
#     nginx.ingress.kubernetes.io/proxy-body-size: 512m
#     nginx.ingress.kubernetes.io/proxy-connect-timeout: "180"
#     nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
#     nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
#   hosts:
#     - host: mlflow.tgu.ovh
#       paths:
#         - path: /
#           pathType: Prefix
#   tls:
#     - secretName: mlflow-tls
#       hosts:
#         - mlflow.tgu.ovh

# # Persistence configuration
# persistence:
#  size: 10Gi
#  accessMode: ReadWriteOnce
