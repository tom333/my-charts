# Default values for umbrella chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Code-server configuration
code-server:
  image:
    repository: tom333/coder
    tag: 'latest'
    pullPolicy: Always
  ingress:
    enabled: true
    hosts:
      - host: code.tgu.ovh
        paths:
          - /
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/auth-url: "https://auth.tgu.ovh/oauth2/auth"
      nginx.ingress.kubernetes.io/auth-signin: "https://auth.tgu.ovh/oauth2/start?rd=https://code.tgu.ovh"
    tls:
      - hosts:
          - code.tgu.ovh
        secretName: code-tls
  extraArgs:
    - --auth
    - none
  extraVars:
    - name: MLFLOW_TRACKING_URI
      value: http://mlflow.datalab.svc.cluster.local:5000
    - name: MLFLOW_S3_ENDPOINT_URL
      value: http://minio.datalab.svc.cluster.local:9000
    - name: DISABLE_TELEMETRY
      value: "true"
    - name: DOCKER_HOST
      value: "tcp://localhost:2375"
  extraContainers: |
    - name: docker-dind
      image: docker:19.03-dind
      imagePullPolicy: IfNotPresent
      resources:
        requests:
          cpu: 250m
          memory: 256M
      securityContext:
        privileged: true
        procMount: Default
      env:
        - name: DOCKER_TLS_CERTDIR
          value: ""
        - name: DOCKER_DRIVER
          value: "overlay2"
  extraInitContainers: |
    - name: customization
      image: {{ .Values.code-server.image.repository }}:{{ .Values.code-server.image.tag }}
      imagePullPolicy: IfNotPresent
      env:
        - name: SERVICE_URL
          value: "https://open-vsx.org/vscode/gallery"
        - name: ITEM_URL
          value: "https://open-vsx.org/vscode/item"
      command:
        - sh
        - -c
        - |
          code-server --install-extension ms-python.python GitHub.vscode-pull-request-github ms-kubernetes-tools.vscode-kubernetes-tools
      volumeMounts:
        - name: data
          mountPath: /home/coder
  # Utilisation de secrets externes pour les informations sensibles
  existingSecret: code-server-secret

# Qdrant configuration
qdrant:
  enabled: true
  apikey:
    enabled: true
    # Utilisation d'un secret pour l'API key
    existingSecret: qdrant-apikey
    existingSecretKey: apikey
  ingress:
    enabled: true
    hosts:
      - host: qdrant.tgu.ovh
        paths:
          - /
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    tls:
      - hosts:
          - qdrant.tgu.ovh
        secretName: qdrant-tls

# Ollama configuration
ollama:
  enabled: true
  ingress:
    enabled: true
    hosts:
      - host: ollama.tgu.ovh
        paths:
          - /
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    tls:
      - hosts:
          - ollama.tgu.ovh
        secretName: ollama-tls